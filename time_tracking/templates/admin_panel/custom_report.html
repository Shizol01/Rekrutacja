{% load static %}
{% load time_filters %}
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Raport czasu pracy</title>
    <link rel="stylesheet" href="{% static 'admin_panel/report.css' %}">
</head>
<body>

<div class="container">

    <a href="/api/admin-panel/live/" class="back">‚Üê Panel live</a>

    <h1>üìä Raport czasu pracy</h1>

    <!-- FORMULARZ -->
    <form method="get" class="filters">
        <label>
            Pracownik:
            <select name="employee" required>
                <option value="">‚Äî wybierz ‚Äî</option>
                {% for e in employees %}
                    <option value="{{ e.id }}"
                        {% if selected_employee and e.id == selected_employee.id %}selected{% endif %}>
                        {{ e }}
                    </option>
                {% endfor %}
            </select>
        </label>

        <label>
            Od:
            <input type="date" name="from" value="{{ date_from|date:'Y-m-d' }}">
        </label>

        <label>
            Do:
            <input type="date" name="to" value="{{ date_to|date:'Y-m-d' }}">
        </label>

        <button type="submit">Generuj raport</button>
    </form>

    {% if report %}

    <!-- CSV -->
    <div class="actions">
        <a class="btn"
           href="/api/admin/reports/attendance.csv/?employee_id={{ selected_employee.id }}&from={{ date_from|date:'Y-m-d' }}&to={{ date_to|date:'Y-m-d' }}">
            ‚¨á Pobierz CSV
        </a>
    </div>

    <!-- PODSUMOWANIE -->
    <div class="summary">
        <div><strong>Plan:</strong> {{ report.totals.planned_minutes|minutes_to_hm }}</div>
        <div><strong>Praca:</strong> {{ report.totals.worked_minutes|minutes_to_hm }} </div>
        <div><strong>Przerwy:</strong> {{ report.totals.break_minutes|minutes_to_hm }} </div>
        <div><strong>Sp√≥≈∫nienia:</strong> {{ report.totals.late_minutes|minutes_to_hm }} </div>
        <div><strong>Absencje:</strong> {{ report.totals.absences }}</div>
        <div><strong>Urlopy:</strong> {{ report.totals.leave_days }}</div>
    </div>

    <!-- TABELA -->
    <table>
        <thead>
        <tr>
            <th>Data</th>
            <th>Typ dnia</th>
            <th>Plan</th>
            <th>Praca</th>
            <th>Przerwy</th>
            <th>Sp√≥≈∫nienie</th>
            <th>Absencja</th>
            <th>Anomalie</th>
        </tr>
        </thead>
        <tbody>
        {% for d in report.days %}
        <tr>
            <td>{{ d.date }}</td>
            <td>{{ d.day_type }}</td>
            <td>{{ d.planned.minutes|minutes_to_hm }}</td>
            <td>{{ d.actual.worked_minutes|minutes_to_hm }}</td>
            <td>{{ d.actual.break_minutes|minutes_to_hm }}</td>
            <td>
                {% if d.lateness_minutes > 0 %}
                    ‚è∞ {{ d.lateness_minutes|minutes_to_hm }}
                {% else %}‚Äî{% endif %}
            </td>
            <td>{{ d.absence|yesno:"TAK,NIE" }}</td>
            <td>
                {% if d.anomalies %}
                    {{ d.anomalies|join:", " }}
                {% else %}‚Äî{% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    {% endif %}

</div>

</body>
</html>
